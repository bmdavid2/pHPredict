xlab("Size of mean shift")+
theme_classic()
plt1
plt1a =ggplot2::ggplot((data=data))+
plt1=ggplot2::ggplot(data=data)+
geom_line(aes(mu,1/p1))+
geom_line(aes(mu,1/p2))+
geom_line(aes(mu,1/p3),color=red)+
geom_line(aes(mu,1/p4))+
#annotate("text",x=mu0+0.25,y=0.25, label="L=1")+
#annotate("text",x=mu0+0.37,y=0.45,label="L=2")+
#annotate("text",x=mu0+0.5,y=0.60,label="L=3")+
#annotate("text",x=mu0+.65,y=0.7,label="L=4")+
ylab("Proabability of a point plotting \n between the control limits")+
xlab("Size of mean shift")+
theme_classic()
plt1a =ggplot2::ggplot((data=data))+
geom_line(aes(mu,1/p1))+
geom_line(aes(mu,1/p2))+
geom_line(aes(mu,1/p3),color=red)+
geom_line(aes(mu,1/p4))+
#annotate("text",x=mu0+0.25,y=0.25, label="L=1")+
#annotate("text",x=mu0+0.37,y=0.45,label="L=2")+
#annotate("text",x=mu0+0.5,y=0.60,label="L=3")+
#annotate("text",x=mu0+.65,y=0.7,label="L=4")+
ylab("Proabability of a point plotting \n between the control limits")+
xlab("Size of mean shift")+
theme_classic()
plt1a
plt1a =ggplot2::ggplot((data=data))+
geom_line(aes(mu,1/p1))+
geom_line(aes(mu,1/p2))+
geom_line(aes(mu,1/p3),color=red)+
#geom_line(aes(mu,1/p4))+
#annotate("text",x=mu0+0.25,y=0.25, label="L=1")+
#annotate("text",x=mu0+0.37,y=0.45,label="L=2")+
#annotate("text",x=mu0+0.5,y=0.60,label="L=3")+
#annotate("text",x=mu0+.65,y=0.7,label="L=4")+
ylab("Proabability of a point plotting \n between the control limits")+
xlab("Size of mean shift")+
theme_classic()
plt1a
library(ggplot2)
library(dplyr)
library(latex2exp)
blue <- "#2c7bb6"
red <- "#d7191c"
mu=seq(0,1,0.01)
mu0=0
sd=0.4
sdw=sd/sqrt(n)
n=4
L=3
sdw=sd/sqrt(n)
UCL=mu0+L*sdw
LCL=mu0-L*sdw
p3=pnorm((UCL-mu)/sdw)-pnorm((LCL-mu)/sdw)
L=2
sdw=sd/sqrt(n)
UCL=mu0+L*sdw
LCL=mu0-L*sdw
p2=pnorm((UCL-mu)/sdw)-pnorm((LCL-mu)/sdw)
L=4
sdw=sd/sqrt(n)
UCL=mu0+L*sdw
LCL=mu0-L*sdw
p4=pnorm((UCL-mu)/sdw)-pnorm((LCL-mu)/sdw)
L=1
sdw=sd/sqrt(n)
UCL=mu0+L*sdw
LCL=mu0-L*sdw
p1=pnorm((UCL-mu)/sdw)-pnorm((LCL-mu)/sdw)
data=data.frame(mu,p1,p2,p3,p4)
plt1=ggplot2::ggplot(data=data)+
geom_line(aes(mu,p1))+
geom_line(aes(mu,p2))+
geom_line(aes(mu,p3),color=red)+
geom_line(aes(mu,p4))+
annotate("text",x=mu0+0.25,y=0.25, label="L=1")+
annotate("text",x=mu0+0.37,y=0.45,label="L=2")+
annotate("text",x=mu0+0.5,y=0.60,label="L=3")+
annotate("text",x=mu0+.65,y=0.7,label="L=4")+
ylab("Proabability of a point plotting \n between the control limits")+
xlab("Size of mean shift")+
theme_classic()
plt1
L=3
n=2
sdw=sd/sqrt(n)
UCL=mu0+L*sdw
LCL=mu0-L*sdw
p3=pnorm((UCL-mu)/sdw)-pnorm((LCL-mu)/sdw)
n=4
sdw=sd/sqrt(n)
UCL=mu0+L*sdw
LCL=mu0-L*sdw
p2=pnorm((UCL-mu)/sdw)-pnorm((LCL-mu)/sdw)
n=8
sdw=sd/sqrt(n)
UCL=mu0+L*sdw
LCL=mu0-L*sdw
p4=pnorm((UCL-mu)/sdw)-pnorm((LCL-mu)/sdw)
n=16
sdw=sd/sqrt(n)
UCL=mu0+L*sdw
LCL=mu0-L*sdw
p1=pnorm((UCL-mu)/sdw)-pnorm((LCL-mu)/sdw)
data=data.frame(mu,p1,p2,p3,p4)
plt2=ggplot2::ggplot(data=data)+
geom_line(aes(mu,p1))+
geom_line(aes(mu,p2),color=red)+
geom_line(aes(mu,p3))+
geom_line(aes(mu,p4))+
annotate("text",x=mu0+0.25,y=0.25, label="n=16")+
annotate("text",x=mu0+0.37,y=0.45,label="n=8")+
annotate("text",x=mu0+0.5,y=0.60,label="n=4")+
annotate("text",x=mu0+0.65,y=0.7,label="n=2")+
ylab("Proabability of a point plotting \n between the control limits")+
xlab("Size of mean shift")+
theme_classic()
plt2
ggsave(paste(basepath,"OC_L.pdf",sep=""),plt1,width=4,height=3)
ggsave(paste(basepath,"OC_n.pdf",sep=""),plt2,width=4,height=3)
pnorm(4)-pnorm(-2)
x=1-(pnorm(4)-pnorm(-2))
x
1/x
x1=c(-1,-1,1,1,0,0,0)
x2=c(-1,1,-1,1,0,0,0)
y=c(39.3,40,40.9,41.5,40.3,40.5,40.7)
data=data.frame(x1,x2,y)
mdl=lm(y~x1+x2,data=data)
summary(mdl)
predict(mdl,c(0,0))
predict(mdl,x=data.framec(0,0))
mean(y[1:4])
pnorm(3)
## plot the temperature of plate example
library(ggplot2)
d=data.frame(x,y)
x=c(3,602,1217,1805)
y=c(0.31,0.32,0.43,0.58)
d=data.frame(x,y)
plt2=ggplot(data=d)+
geom_point(aes(x,y))+
them_classic()
x=c(3,602,1217,1805)
y=c(0.31,0.32,0.43,0.58)
d=data.frame(x,y)
plt2=ggplot(data=d)+
geom_point(aes(x,y))+
theme_classic()
plt2
x=c(3,602,1217,1805)/60
y=c(0.31,0.32,0.43,0.58)
d=data.frame(x,y)
plt2=ggplot(data=d)+
geom_point(aes(x,y))+
theme_classic()+
ylim(c(0.2,0.6))+
scale_x_continuous()
plt2
d=data.frame(x,y)
plt2=ggplot(data=d)+
geom_point(aes(x,y))+
theme_classic()+
ylim(c(0.2,0.6))+
xlab("Machine Time (min)")+
ylab("OD600")
plt2
x=c(3,602,1217,1805)/60
y=c(0.31,0.32,0.43,0.58)
d=data.frame(x,y)
plt2=ggplot(data=d)+
geom_point(aes(x,y))+
theme_classic()+
ylim(c(0.2,0.6))+
xlab("Machine Time (min)")+
ylab("OD600")
plt2
ggsave("/Users/BDavid/Dropbox (University of Michigan)/Apps/Overleaf/Benjamin David PhD Thesis/figures/CHESS/read_timeseries.png",plt,width=2.5 ,height= 2.5 )
ggsave("/Users/BDavid/Dropbox (University of Michigan)/Apps/Overleaf/Benjamin David PhD Thesis/figures/CHESS/read_timeseries.png",plt2,width=2.5 ,height= 2.5 )
setwd("~/Documents/GitHub/JLDispense/benchmarking")
setwd("~/Documents/GitHub/JLDispense/benchmarking")
library(ggplot2)
data = read.csv("benchmark_2025_06_02.csv")
setwd("~/Documents/GitHub/JLDispense/benchmarking")
library(ggplot2)
data = read.csv("benchmark_2025-06-02.csv")
maximum(data$time)
max(data$time)
hist(data$time)
data= data[setdiff(1:end,c(58,397)),]
data = read.csv("benchmark_2025-06-02.csv")
data= data[setdiff(1:end,c(58,397)),]
data= data[setdiff(1:nrow(data),c(58,397)),]
library(ggplot2)
data = read.csv("benchmark_2025-06-02.csv")
data= data[setdiff(1:nrow(data),c(58,397)),]
insts=c("P-200","P-100 Multichannel","PlateMaster","Nimbus","Cobra")
pistons=c(1,1,1,1,4)
channels=c(1,8,96,1,4)
piston_dict= as.list(setNames(pistons,insts))
channel_dict= as.list(setNames(channels,insts))
piston_vals=rep(0,nrow(data))
channel_vals=rep(0,nrow(data))
for (i in 1:nrow(data)){
instruments = data$instruments[i]
instruments = as.vector(strsplit(instruments,","))
p = 0
c=0
for (inst in instruments[[1]]){
p = p + piston_dict[inst][[1]]
c = c + channel_dict[inst][[1]]
}
piston_vals[i]= p
channel_vals[i]=c
}
data$pistons= piston_vals
data$channels=channel_vals
model <- lm(time ~ I(wells^2)*I(pistons^2),data=data)
summary(model)
data$pistons = piston_vals
max(data$time)
hist(data$time)
which.max(data$time)
data[297]
data[297;]
data[297, ]
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^2*pistons^2,y=time))+
theme_classic()
plt
plot(model)
plt
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^4*pistons^2,y=time))+
theme_classic()
plt
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^3*pistons^2,y=time))+
theme_classic()
plt
model <- lm(time ~ I(wells^3)*I(pistons^2),data=data)
summary(model)
model <- lm(time ~ I(wells^4)*I(pistons^2),data=data)
summary(model)
plot(model)
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^4*pistons^2,y=time))+
theme_classic()
plt
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^4*pistons^2,y=log(time)))+
theme_classic()
plt
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^4*pistons^2,y=exp(time)))+
theme_classic()
plt
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^4*pistons^2,y=time^2))+
theme_classic()
plt
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^4*pistons^2,y=time))+
theme_classic()
plt
data$pistons= piston_vals
data$channels=channel_vals
model <- lm(time ~ I(wells^4)*I(pistons^2),data=data)
summary(model)
plot(model)
summary(model)
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^4*pistons^2,y=time))+
theme_classic()
plt
plot(model)
model <- lm(time ~ I(wells^3)*I(pistons^3),data=data)
summary(model)
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^4*pistons^2,y=time))+
theme_classic()
plt
data$pistons= piston_vals
data$channels=channel_vals
model <- lm(time ~ I(wells^3)*I(pistons^3)*chanels,data=data)
data$pistons= piston_vals
data$channels=channel_vals
model <- lm(time ~ I(wells^3)*I(pistons^3)*channels,data=data)
summary(model)
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^3*pistons^3*channels,y=time))+
theme_classic()
plt
model <- lm(time ~ I(wells^3)*I(pistons^3)*I(channels),data=data)
summary(model)
data$pistons= piston_vals
data$channels=channel_vals
model <- lm(time ~ I(wells^3)*I(pistons^3),data=data)
summary(model)
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^3*pistons^3,y=time))+
theme_classic()
plt
View(data)
data$channels=channel_vals
model <- lm(time ~ I(wells^3)*I(pistons^3)*I(chemicals),data=data)
summary(model)
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^3*pistons^3*chemicals,y=time))+
theme_classic()
plt
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^3*pistons^3*chemicals+wells^3*pistons^3,y=time))+
theme_classic()
plt
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^3*pistons^3),y=time))+
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^3*pistons^3,y=time))+
theme_classic()
plt
model <- lm(time ~ I(wells^4)*I(pistons^2)*I(chemicals),data=data)
summary(model)
model <- lm(time ~ I(wells^4)*I(pistons^2)*I(chemicals),data=data)
summary(model)
plt <- ggplot(data=data) +
geom_point(mapping=aes(x=wells^4*pistons^2,y=time))+
theme_classic()
plt
setwd("~/Documents/GitHub/pHPredict")
devtools::load_all(())
devtools::load_all()
devtools::load_all()
testing_data_THY
x=testing_data_THY
View(x)
f <- "/Users/BDavid/Dropbox-UniversityofMichigan/Benjamin David/JensenLab/dye_files/BioTek Reads/2025_07_07_pH_standards.xlsx"
k = c(25,70,115,160)
test <- data.frame()
for (i in 1:4){
t <- openxlsx::read.xlsx(f, rows = k[i]:(k[i]+41), cols = 3:99, colNames=TRUE)
if (i==1){
test = t
}else{
test <- cbind(test,t)
}
}
wv <- openxlsx::read.xlsx(f, rows = k[1]:(k[1]+41), cols = 2, colNames=TRUE)
wvnames <- paste0("wv",wv[,1])
testdata <- data.frame(t(test))[1:192,]
names(testdata) = wvnames
pH_vals <- c(4.42,4.78,5.03,5.49,5.92,6.47,7.00,7.5,7.96,8.35,8.75,9.12)
pH <- rep(pH_vals, each=2,times=8)
dye1 <- c("blank","universal")
dye2 <- c("phenol","bromphenol")
dyes <- rep(c(rep(dye1,times=12),rep(dye2,times=12)),times=4)
testdata$pH <- pH_vals
testdata$dye <- dyes
View(testdata)
wv <- openxlsx::read.xlsx(f, rows = k[1]:(k[1]+41), cols = 2, colNames=TRUE)
wvnames <- paste0("wv",wv[,1])
testdata <- data.frame(t(test))[1:192,]
names(testdata) = wvnames
pH_vals <- c(4.42,4.78,5.03,5.49,5.92,6.47,7.00,7.5,7.96,8.35,8.75,9.12)
pH <- rep(pH_vals, each=2,times=8)
dye1 <- c("blank","universal")
dye2 <- c("phenol","bromphenol")
dyes <- rep(c(rep(dye1,times=12),rep(dye2,times=12)),times=4)
testdata$pH <- pH
testdata$dye <- dyes
View(testdata)
testing_data_THY <- testdata
usethis::use_data(testing_data_THY,overwrite=TRUE)
devtools::load_all()
library(daewr)
library(rsm)
data <- training_data_THY[,c(1:10,13)]
names(data)[1:10] = paste0("wv",wavelengths)
library(daewr)
library(rsm)
wavelengths <-  c(510,520,530,550,560,570,610,620,630,700)
data <- training_data_THY[,c(1:10,13)]
names(data)[1:10] = paste0("wv",wavelengths)
mdl <- lm(pH ~ SO(wv510,wv520,wv530,wv550,wv560,wv570,wv610,wv620,wv630,wv700), data=data)
summary(mdl)
wvnames <- paste0("wv",wavelengths)
test <- data.frame(mapply(as.numeric,testing_data_THY[,wvnames]))
test <- cbind(test,testing_data_THY[,c("dye","pH")])
testdata <- subtract_background(test,"universal")
testdata <- normalize(testdata)
wvcols <- grepl("wv",names(testdata))
x <- predict.lm(mdl,testdata[,wvcols])
plot(x,data$pH)
plot(x,testdata$pH)
plot(testdata$pH,x)
library(daewr)
library(rsm)
wavelengths <-  c(510,520,530,550,560,570,610,620,630,700)
data <- training_data_THY[,c(1:10,13)]
names(data)[1:10] = paste0("wv",wavelengths)
mdl <- lm(pH ~ FO(wv510,wv520,wv530,wv550,wv560,wv570,wv610,wv620,wv630,wv700), data=data)
summary(mdl)
wvnames <- paste0("wv",wavelengths)
test <- data.frame(mapply(as.numeric,testing_data_THY[,wvnames]))
test <- cbind(test,testing_data_THY[,c("dye","pH")])
testdata <- subtract_background(test,"universal")
testdata <- normalize(testdata)
wvcols <- grepl("wv",names(testdata))
x <- predict.lm(mdl,testdata[,wvcols])
plot(testdata$pH,x)
library(daewr)
library(rsm)
wavelengths <-  c(510,520,530,550,560,570,610,620,630,700)
data <- training_data_THY[,c(1:10,13)]
names(data)[1:10] = paste0("wv",wavelengths)
mdl <- lm(pH ~ FO(wv510,wv520,wv530,wv550,wv560,wv570,wv610,wv620,wv630,wv700)+TWI(wv510,wv520,wv530,wv550,wv560,wv570,wv610,wv620,wv630,wv700), data=data)
summary(mdl)
wvnames <- paste0("wv",wavelengths)
test <- data.frame(mapply(as.numeric,testing_data_THY[,wvnames]))
test <- cbind(test,testing_data_THY[,c("dye","pH")])
testdata <- subtract_background(test,"universal")
testdata <- normalize(testdata)
wvcols <- grepl("wv",names(testdata))
x <- predict.lm(mdl,testdata[,wvcols])
plot(x,data$pH)
plot(testdata$pH,x)
summary(mdl)
wavelengths <-  c(510,520,530,550,560,570,610,620,630,700)
data <- training_data_THY[,c(1:10,13)]
names(data)[1:10] = paste0("wv",wavelengths)
mdl <- lm(pH ~ FO(wv510,wv520,wv530,wv550,wv560,wv570,wv610,wv620,wv630,wv700)+TWI(wv510,wv520,wv530,wv550,wv560,wv570,wv610,wv620,wv630,wv700), data=data)
summary(mdl)
wvnames <- paste0("wv",wavelengths)
test <- data.frame(mapply(as.numeric,testing_data_THY[,wvnames]))
test <- cbind(test,testing_data_THY[,c("dye","pH")])
testdata <- subtract_background(test,"universal")
testdata <- normalize(testdata)
wvcols <- grepl("wv",names(testdata))
x <- predict.lm(mdl,testdata[,wvcols])
preds <- data.frame(pH = testdata$pH, linear_model <- x)
plt1 <- ggplot(data=preds)+
geom_point(aes(x=pH,y=linear_model))+
theme_classic()
library(daewr)
library(rsm)
library(ggplot2)
wavelengths <-  c(510,520,530,550,560,570,610,620,630,700)
data <- training_data_THY[,c(1:10,13)]
names(data)[1:10] = paste0("wv",wavelengths)
mdl <- lm(pH ~ FO(wv510,wv520,wv530,wv550,wv560,wv570,wv610,wv620,wv630,wv700)+TWI(wv510,wv520,wv530,wv550,wv560,wv570,wv610,wv620,wv630,wv700), data=data)
summary(mdl)
wvnames <- paste0("wv",wavelengths)
test <- data.frame(mapply(as.numeric,testing_data_THY[,wvnames]))
test <- cbind(test,testing_data_THY[,c("dye","pH")])
testdata <- subtract_background(test,"universal")
testdata <- normalize(testdata)
wvcols <- grepl("wv",names(testdata))
x <- predict.lm(mdl,testdata[,wvcols])
preds <- data.frame(pH = testdata$pH, linear_model <- x)
plt1 <- ggplot(data=preds)+
geom_point(aes(x=pH,y=linear_model))+
theme_classic()
plt1
pred_gp <-  train(training_data_THY,training_data_THY$pH,gp_model)
pred_gp(testdata[,1:10])
gp_prediction <- pred_gp(testdata[,1:10])
preds <- data.frame(pH = testdata$pH, linear_model <- x, gp_model <- gp_prediction$mean_pH)
plt1 <- ggplot(data=preds)+
geom_point(aes(x=pH,y=linear_model))+
geom_abline(slope=1,intercept = 0,color="red")
theme_classic()
plt1
plt2 <- ggplot(data=preds)+
geom_point(aes(x=pH,y=gp_model))+
abline(slope=1,intercept=0,color="red")+
theme_classic()
plt2
cowplot::plot_grid(plt1,plt2)
plt1 <- ggplot(data=preds)+
geom_point(aes(x=pH,y=linear_model))+
geom_abline(slope=1,intercept = 0,color="red")+
theme_classic()
plt1
plt2 <- ggplot(data=preds)+
geom_point(aes(x=pH,y=gp_model))+
abline(slope=1,intercept=0,color="red")+
theme_classic()
plt2
cowplot::plot_grid(plt1,plt2)
plt1 <- ggplot(data=preds)+
geom_point(aes(x=pH,y=linear_model))+
geom_abline(slope=1,intercept = 0,color="red")+
theme_classic()
plt1
plt2 <- ggplot(data=preds)+
geom_point(aes(x=pH,y=gp_model))+
geom_abline(slope=1,intercept=0,color="red")+
theme_classic()
plt2
cowplot::plot_grid(plt1,plt2)
cowplot::plot_grid(plt1,plt2)
lm_rsmse <- sqrt(mean(preds$pH-preds$linear_model....x)^2)
lm_rsmse
gp_rsmse <- sqrt(mean(preds$pH-preds$gp_model....gp_prediction.mean_pH)^2)
gp_rsmse
?train
?pHPredict
devtools::load_all()
training_data_THY
